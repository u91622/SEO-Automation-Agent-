{
    "name": "Notion SEO & Grammar Agent (Slack)",
    "nodes": [
        {
            "parameters": {
                "pollTimes": {
                    "item": [
                        {
                            "mode": "everyMinute"
                        }
                    ]
                },
                "event": "pagedAddedToDatabase"
            },
            "id": "notion-trigger",
            "name": "Notion Trigger",
            "type": "n8n-nodes-base.notionTrigger",
            "typeVersion": 1,
            "position": [
                380,
                240
            ],
            "credentials": {
                "notionApi": {
                    "id": "",
                    "name": ""
                }
            }
        },
        {
            "parameters": {
                "method": "GET",
                "url": "={{ 'https://api.notion.com/v1/blocks/' + $json.id + '/children' }}",
                "authentication": "predefinedCredentialType",
                "nodeCredentialType": "notionApi"
            },
            "id": "get-content",
            "name": "Get Page Content (HTTP)",
            "type": "n8n-nodes-base.httpRequest",
            "typeVersion": 3,
            "position": [
                600,
                240
            ],
            "credentials": {
                "notionApi": {
                    "id": "",
                    "name": ""
                }
            }
        },
        {
            "parameters": {
                "jsCode": "const httpResponses = $input.all();\nconst triggerItems = $node[\"Notion Trigger\"].json;\n\n// Ensure triggerItems is an array (n8n quirk handling)\nconst triggers = Array.isArray(triggerItems) ? triggerItems : [triggerItems];\n\nconst results = [];\n\nfor (let i = 0; i < httpResponses.length; i++) {\n  const blocks = httpResponses[i].json.results || [];\n  let fullText = \"\";\n\n  // Extract text from blocks\n  for (const block of blocks) {\n    const type = block.type;\n    if (block[type] && block[type].rich_text) {\n      const textContent = block[type].rich_text.map(t => t.plain_text).join(\"\");\n      fullText += textContent + \"\\n\";\n    }\n  }\n\n  // Match with Trigger data by index to get ID and Title\n  const triggerData = triggers[i] || triggers[0]; \n  const pageId = triggerData.id;\n\n  // Dynamic Title Retrieval\n  const properties = triggerData.properties;\n  let title = \"Untitled\";\n  if (properties) {\n    for (const key in properties) {\n      if (properties[key].type === \"title\") {\n        title = properties[key].title[0]?.plain_text || \"Untitled\";\n        break;\n      }\n    }\n  }\n\n  results.push({\n    json: {\n      pageId,\n      fullText,\n      title\n    }\n  });\n}\n\nreturn results;"
            },
            "id": "prepare-data",
            "name": "Prepare Data",
            "type": "n8n-nodes-base.code",
            "typeVersion": 2,
            "position": [
                820,
                240
            ]
        },
        {
            "parameters": {
                "method": "POST",
                "url": "https://api.cerebras.ai/v1/chat/completions",
                "authentication": "genericCredentialType",
                "genericAuthType": "httpHeaderAuth",
                "sendHeaders": true,
                "headerParameters": {
                    "parameters": [
                        {
                            "name": "Content-Type",
                            "value": "application/json"
                        }
                    ]
                },
                "sendBody": true,
                "bodyParameters": {
                    "parameters": [
                        {
                            "name": "model",
                            "value": "gpt-oss-120b"
                        },
                        {
                            "name": "messages",
                            "value": "={{ [\n  {\"role\": \"system\", \"content\": \"You are an SEO and Grammar expert editing a blog post. Analyze the text. Return ONLY a valid JSON object (no markdown formatting, no code blocks) with the following structure:\\n{\\n  \\\"score\\\": number (0-100),\\n  \\\"issues\\\": [\\\"issue 1\\\", \\\"issue 2\\\"],\\n  \\\"suggestions\\\": [\\\"suggestion 1\\\", \\\"suggestion 2\\\"]\\n}\"}, \n  {\"role\": \"user\", \"content\": $json.fullText}\n] }}"
                        },
                        {
                            "name": "temperature",
                            "value": 0.2
                        }
                    ]
                },
                "options": {}
            },
            "id": "cerebras-ai",
            "name": "Cerebras AI Analysis",
            "type": "n8n-nodes-base.httpRequest",
            "typeVersion": 4.1,
            "position": [
                1040,
                240
            ],
            "credentials": {
                "httpHeaderAuth": {
                    "id": "",
                    "name": ""
                }
            }
        },
        {
            "parameters": {
                "jsCode": "const aiContent = $json.choices[0].message.content;\nlet analysis = {};\n\ntry {\n  const cleanJson = aiContent.replace(/```json/g, '').replace(/```/g, '').trim();\n  analysis = JSON.parse(cleanJson);\n} catch (e) {\n  analysis = { score: 0, issues: [\"JSON Parse Error\"], suggestions: [\"Check AI Output\"] };\n}\n\n// Retrieve original data (Page ID, Title) from the 'Prepare Data' node\nconst originalData = $node[\"Prepare Data\"].json;\n\nreturn {\n  json: {\n    ...originalData,\n    analysis\n  }\n};"
            },
            "id": "parse-response",
            "name": "Parse Response",
            "type": "n8n-nodes-base.code",
            "typeVersion": 2,
            "position": [
                1260,
                240
            ]
        },
        {
            "parameters": {
                "conditions": {
                    "number": [
                        {
                            "value1": "={{ $json.analysis.score }}",
                            "operation": "largerEqual",
                            "value2": 80
                        }
                    ]
                }
            },
            "id": "check-score",
            "name": "Check Score",
            "type": "n8n-nodes-base.if",
            "typeVersion": 1,
            "position": [
                1480,
                240
            ]
        },
        {
            "parameters": {
                "resource": "databasePage",
                "operation": "update",
                "pageId": {
                    "__rl": true,
                    "value": "={{ $json.pageId }}",
                    "mode": "id"
                },
                "propertiesUi": {
                    "propertyValues": [
                        {
                            "key": "Status|text",
                            "textValue": "Ready"
                        },
                        {
                            "key": "SEO Score|number",
                            "numberValue": "={{ $json.analysis.score }}"
                        }
                    ]
                }
            },
            "id": "update-success",
            "name": "Update Notion (Pass)",
            "type": "n8n-nodes-base.notion",
            "typeVersion": 2,
            "position": [
                1700,
                100
            ],
            "credentials": {
                "notionApi": {
                    "id": "",
                    "name": ""
                }
            }
        },
        {
            "parameters": {
                "resource": "databasePage",
                "operation": "update",
                "pageId": {
                    "__rl": true,
                    "value": "={{ $json.pageId }}",
                    "mode": "id"
                },
                "propertiesUi": {
                    "propertyValues": [
                        {
                            "key": "Status|text",
                            "textValue": "Needs Revision"
                        },
                        {
                            "key": "SEO Score|number",
                            "numberValue": "={{ $json.analysis.score }}"
                        }
                    ]
                }
            },
            "id": "update-fail",
            "name": "Update Notion (Fail)",
            "type": "n8n-nodes-base.notion",
            "typeVersion": 2,
            "position": [
                1700,
                380
            ],
            "credentials": {
                "notionApi": {
                    "id": "",
                    "name": ""
                }
            }
        },
        {
            "parameters": {
                "resource": "block",
                "blockId": {
                    "__rl": true,
                    "value": "={{ $json.pageId }}",
                    "mode": "id"
                },
                "blockUi": {
                    "blockValues": [
                        {
                            "type": "heading_2",
                            "textContent": "ü§ñ AI Revision Suggestions"
                        },
                        {
                            "type": "paragraph",
                            "textContent": "={{ $json.analysis.suggestions.join('\\n- ') }}"
                        }
                    ]
                }
            },
            "id": "append-suggestions",
            "name": "Append Suggestions",
            "type": "n8n-nodes-base.notion",
            "typeVersion": 2,
            "position": [
                1920,
                380
            ],
            "credentials": {
                "notionApi": {
                    "id": "",
                    "name": ""
                }
            }
        },
        {
            "parameters": {
                "channelId": {
                    "__rl": true,
                    "value": "YOUR_CHANNEL_ID",
                    "mode": "list",
                    "cachedResultName": "general"
                },
                "text": "={{ 'üéâ Êñ∞ÊñáÁ´†Â∑≤Â∞±Á∑íÔºÅ\\nÊ®ôÈ°åÔºö' + $json.title + '\\nSEO ÂàÜÊï∏Ôºö' + $json.analysis.score }}",
                "otherOptions": {}
            },
            "id": "slack-success",
            "name": "Slack (Success)",
            "type": "n8n-nodes-base.slack",
            "typeVersion": 2.1,
            "position": [
                1920,
                100
            ],
            "credentials": {
                "slackApi": {
                    "id": "",
                    "name": ""
                }
            }
        },
        {
            "parameters": {
                "channelId": {
                    "__rl": true,
                    "value": "YOUR_CHANNEL_ID",
                    "mode": "list",
                    "cachedResultName": "general"
                },
                "text": "={{ '‚ö†Ô∏è ÊñáÁ´†ÈúÄ‰øÆÊîπ\\nÊ®ôÈ°åÔºö' + $json.title + '\\nSEO ÂàÜÊï∏Ôºö' + $json.analysis.score + '\\n\\n‰∏ªË¶ÅÂïèÈ°åÔºö\\n- ' + $json.analysis.issues.join('\\n- ') }}",
                "otherOptions": {}
            },
            "id": "slack-fail",
            "name": "Slack (Fail)",
            "type": "n8n-nodes-base.slack",
            "typeVersion": 2.1,
            "position": [
                2140,
                380
            ],
            "credentials": {
                "slackApi": {
                    "id": "",
                    "name": ""
                }
            }
        }
    ],
    "connections": {
        "Notion Trigger": {
            "main": [
                [
                    {
                        "node": "Get Page Content (HTTP)",
                        "type": "main",
                        "index": 0
                    },
                    {
                        "node": "Prepare Data",
                        "type": "main",
                        "index": 0
                    }
                ]
            ]
        },
        "Get Page Content (HTTP)": {
            "main": [
                [
                    {
                        "node": "Prepare Data",
                        "type": "main",
                        "index": 0
                    }
                ]
            ]
        },
        "Prepare Data": {
            "main": [
                [
                    {
                        "node": "Cerebras AI Analysis",
                        "type": "main",
                        "index": 0
                    }
                ]
            ]
        },
        "Cerebras AI Analysis": {
            "main": [
                [
                    {
                        "node": "Parse Response",
                        "type": "main",
                        "index": 0
                    }
                ]
            ]
        },
        "Parse Response": {
            "main": [
                [
                    {
                        "node": "Check Score",
                        "type": "main",
                        "index": 0
                    }
                ]
            ]
        },
        "Check Score": {
            "main": [
                [
                    {
                        "node": "Update Notion (Pass)",
                        "type": "main",
                        "index": 0
                    }
                ],
                [
                    {
                        "node": "Update Notion (Fail)",
                        "type": "main",
                        "index": 0
                    }
                ]
            ]
        },
        "Update Notion (Pass)": {
            "main": [
                [
                    {
                        "node": "Slack (Success)",
                        "type": "main",
                        "index": 0
                    }
                ]
            ]
        },
        "Update Notion (Fail)": {
            "main": [
                [
                    {
                        "node": "Append Suggestions",
                        "type": "main",
                        "index": 0
                    }
                ]
            ]
        },
        "Append Suggestions": {
            "main": [
                [
                    {
                        "node": "Slack (Fail)",
                        "type": "main",
                        "index": 0
                    }
                ]
            ]
        }
    }
}